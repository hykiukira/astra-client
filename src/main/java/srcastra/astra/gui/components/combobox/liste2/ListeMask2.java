/* * IntegerMask.java * * Created on 10 mai 2002, 16:38 */package srcastra.astra.gui.components.combobox.liste2;import javax.swing.text.*;import srcastra.astra.gui.components.textFields.ATextFieldComponent;import java.util.Locale;import srcastra.astra.gui.test.*;import srcastra.astra.gui.components.combobox.liste2.*;import srcastra.astra.gui.sys.utils.*;import srcastra.astra.sys.rmi.*;import srcastra.astra.sys.rmi.Exception.*;import java.rmi.*;import java.util.*;import javax.swing.*;import srcastra.astra.sys.classetransfert.*;import srcastra.astra.sys.classetransfert.clients.*;/** * @author Sébastien */public class ListeMask2 extends srcastra.astra.gui.sys.formVerification.DefaultMask {////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// CONSTRUCTORS////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////    /**     * Creates new IntegerMask     */    int colToSearch = 1;    public ListeMask2(astrainterface serveur, int minLenght, int maxLenght, Locale locale, int caseType, ListeModelInterface model, Liste2 parent, int longueurtexte) {        super(minLenght, maxLenght, locale, caseType);        m_parent = parent;        m_model = model;        m_serveur = serveur;        m_longeur_saisie = longueurtexte;    }    public void setColumn(int column) {        m_column = column;    }////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// METHODES APPARENTE AU BEANS////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////    public void insertString(int offs, String str, AttributeSet a) throws BadLocationException {        String currentText = getText(0, getLength());        String beforeOffset = currentText.substring(0, offs);        String afterOffset = currentText.substring(offs, currentText.length());        //System.out.println("[*********]INSERTSTRING");        boolean check = false;        String proposedResult = beforeOffset + str + afterOffset;        if (str.equals("") || proposedResult.length() <= m_parent.getNbr_lettre_avant_affichage()) {            super.insertString(offs, str, a);        } else {            if (!sw) {                m_model.loadata(proposedResult);                sw = true;            }            if (!m_parent.isModedisplay()) {                if (!search) {                    if (m_model.getM_vector().size() > 0) {                        if (!m_parent.getGrp_PopMenu_popup().isVisible()) affichePopup(true);                        check = search(proposedResult);                        if (check) {                            super.insertString(offs, str, a);                            m_parent.setGoodIcon(true);                            m_parent.getGrp_TField_encode().requestFocus();                        } else {                            java.awt.Toolkit.getDefaultToolkit().beep();                            JToolTip toolTip = new JToolTip();                            toolTip.setToolTipText("test");                            toolTip.setComponent(m_parent.getGrp_Table_table());                            toolTip.setVisible(true);                            System.out.println("showtooltip");                            m_parent.getGrp_TField_encode().requestFocus();                        }                    } else {                        java.awt.Toolkit.getDefaultToolkit().beep();                        JToolTip toolTip = new JToolTip();                        toolTip.setToolTipText("test");                        toolTip.setComponent(m_parent.getGrp_Table_table());                        toolTip.setVisible(true);                        System.out.println("showtooltip");                        m_parent.getGrp_TField_encode().requestFocus();                        sw = false;                    }                } else {                    super.insertString(offs, str, a);                    search = false;                }            } else {                super.insertString(offs, str, a);                search = false;            }        }    }    private boolean search(String proposedResult) {        boolean check = false;        position = m_model.searchAWord(proposedResult, colToSearch);        System.out.println("search position :" + position);        if (position > -1 && position < m_parent.getGrp_Table_table().getRowCount()) {            String word = m_parent.getGrp_Table_table().getValueAt(position, 0).toString();            // char[] wordtab=word.toUpperCase().toCharArray();            char[] proposetab = proposedResult.toUpperCase().toCharArray();            int longueur = proposetab.length;            if (longueur <= word.length()) {                String tmp = word.substring(0, longueur);                if (tmp.toUpperCase().equals(proposedResult.toUpperCase())) check = true;                if (position > -1 && position < m_parent.getGrp_Table_table().getRowCount() && check == true)                    m_parent.getGrp_Table_table().setRowSelectionInterval(position, position);                m_parent.getGrp_Table_table().scrollRectToVisible(new java.awt.Rectangle(0, m_parent.getGrp_Table_table().getRowHeight() * position, 20, m_parent.getGrp_Table_table().getRowHeight()));                Object[] tmptab = (Object[]) getObject(m_parent.getGrp_Table_table().getSelectedRow());                if (tmptab != null) {                    try {                        if (tmptab[0] instanceof Long) m_parent.setCleUnik(((Long) tmptab[0]).intValue());                        else m_parent.setCleUnik2(((Integer) tmptab[0]).intValue());                    } catch (NumberFormatException nn) {                        nn.printStackTrace();                    }                }            }        }        return check;    }    public Object getObject(int position) {        //ListeObjectAffichage client=m_model.getClassAffichage2(position);        //if(client==null) return null;        //InterfaceClasseTransfert tmp=m_model.getClassAffichage2(position).getParent();        // return tmp;        return m_model.getM_vector().get(position);    }    public void remove(int offs, int len) throws BadLocationException {        // String result = m_parent.getGrp_TField_encode().getText(0,m_parent.getGrp_TField_encode().getText().length());        super.remove(offs, len);        System.out.println("[*********]REMOVE");        //   if(validate==false || m_parent.isModedisplay()){        super.remove(offs, len);        String result = m_parent.getGrp_TField_encode().getText(0, getLength());        System.out.println("je remove " + result.length());        if (m_parent.getNbr_lettre_avant_affichage() == 0) {            if (result.length() == 0) {                // if(!first){                if (m_parent.getGrp_PopMenu_popup().isVisible()) affichePopup(false);                sw = false;                // m_parent.setModedisplay(false);                //}                first = false;            } else {                if (m_parent.getGrp_PopMenu_popup().isVisible()) search(result);            }        } else {            //if(!first){            if (result.length() < m_parent.getNbr_lettre_avant_affichage()) {                if (m_parent.getGrp_PopMenu_popup().isVisible()) affichePopup(false);                sw = false;                //   m_parent.setModedisplay(false);                //}                first = false;            } else {                if (m_parent.getGrp_PopMenu_popup().isVisible()) search(result);            }        }        //    }    }    public void affichePopup(boolean sw) {        if (sw == true) {            //  m_model.loadata("d");            // m_parent.getGrp_Table_table().repaint();            m_parent.getGrp_PopMenu_popup().setVisible(true);            int x = m_parent.getGrp_PopMenu_popup().getBorder().getBorderInsets(m_parent.getGrp_PopMenu_popup()).right - m_parent.getGrp_TField_encode().getX();            //  m_parent.getGrp_PopMenu_popup().setSize( m_parent.getGrp_PopMenu_popup().getWidth(),m_parent.getGrp_Table_table().getHeight());            if (m_parent.isLeft() && !m_parent.isUp())                m_parent.getGrp_PopMenu_popup().show(m_parent, (m_parent.getGrp_TField_encode().getX() + m_parent.getGrp_TField_encode().getWidth()) - m_parent.getGrp_PopMenu_popup().getWidth(), m_parent.getGrp_TField_encode().getY() + 18);            else if (!m_parent.isLeft() && !m_parent.isUp())                m_parent.getGrp_PopMenu_popup().show(m_parent, m_parent.getGrp_TField_encode().getX(), m_parent.getGrp_TField_encode().getY() + 18);            else if (m_parent.isLeft() && m_parent.isUp())                m_parent.getGrp_PopMenu_popup().show(m_parent, (m_parent.getGrp_TField_encode().getX() + m_parent.getGrp_TField_encode().getWidth()) - m_parent.getGrp_PopMenu_popup().getWidth(), m_parent.getGrp_TField_encode().getY());            else if (!m_parent.isLeft() && m_parent.isUp())                m_parent.getGrp_PopMenu_popup().show(m_parent, m_parent.getGrp_TField_encode().getX(), m_parent.getGrp_TField_encode().getY());            // model.loadData(this.array);            m_parent.getGrp_Table_table().repaint();            m_parent.getGrp_PopMenu_popup().repaint();            if (m_parent.getGrp_Table_table().getRowCount() > 0)                m_parent.getGrp_Table_table().changeSelection(0, 0, false, false);            m_parent.setFocusFromTable(true);            m_parent.getGrp_TField_encode().requestFocus();        } else {            m_parent.getGrp_PopMenu_popup().setVisible(false);            m_parent.getGrp_TField_encode().requestFocus();        }    }    public int searchByKey(int i) {        search = true;        int j = m_model.searchAWord(new Integer(i), 0);        System.out.println("position" + j);        if (j >= 0 && j < m_model.getM_vector_by_key().size()) {            Object[] tmpobj = (Object[]) m_model.getM_vector_by_key().get(j);            m_parent.getGrp_TField_encode().setText(tmpobj[1].toString());            int size = tmpobj.length;            System.out.println("VALEUR trouvée" + tmpobj[1].toString());            return ((Integer) tmpobj[size - 1]).intValue();        }        return 0;    }    /**     * Getter for property validate.     *     * @return Value of property validate.     */    public boolean isValidate() {        return validate;    }    /**     * Setter for property validate.     *     * @param validate New value of property validate.     */    public void setValidate(boolean validate) {        this.validate = validate;    }    /** Getter for property position.     * @return Value of property position.     */    /**     * Setter for property position.     *     * @param position New value of property position.     */    public void setPosition(int position) {        this.position = position;    }    /**     * Getter for property first.     *     * @return Value of property first.     */    public boolean isFirst() {        return first;    }    /**     * Setter for property first.     *     * @param first New value of property first.     */    public void setFirst(boolean first) {        this.first = first;    }    /**     * Getter for property colToSearch.     *     * @return Value of property colToSearch.     */    public int getColToSearch() {        return colToSearch;    }    /**     * Setter for property colToSearch.     *     * @param colToSearch New value of property colToSearch.     */    public void setColToSearch(int colToSearch) {        this.colToSearch = colToSearch;    }////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// STATIC VARIABLES////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////    /**     * value for erreur code     */    public static int ERREUR_CODE = srcastra.astra.gui.sys.formVerification.FormVerification.ERREUR_STRING;    private int currentposition;    ListeModelInterface m_model;    Liste2 m_parent;    int m_column;    astrainterface m_serveur;    boolean charger = false;    int m_longeur_saisie;    ArrayList array;    int position;    boolean validate;    boolean search;    boolean sw;    boolean first;}