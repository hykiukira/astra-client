/*

 * TvaFrame.java

 *

 * Created on 28 avril 2003, 8:48

 */


package srcastra.astra.gui.components.tva;

import javax.swing.tree.*;

import javax.swing.event.*;

import java.awt.event.*;

import srcastra.astra.sys.*;

import srcastra.astra.sys.rmi.*;

import srcastra.astra.sys.classetransfert.*;

import java.util.*;

import srcastra.astra.gui.modules.*;


/**
 * @author thomas
 */

public class TvaFrame extends javax.swing.JDialog implements TreeSelectionListener, java.io.Serializable {


    /**
     * Creates new form TvaFrame
     */

    TvaMediator tvamediator;

    TreePath path;

    MyMouseListener listener;

    javax.swing.JDialog thisframe;

    transient TvaMain tvamain;

    // transient java.awt.Frame parent;

    TvaFrame.My_actionPerformed action;

    MainScreenModule parent;

    public TvaFrame(java.awt.Frame parent2, boolean modal, astrainterface serveur, Loginusers_T user, int type, MainScreenModule parent) {

        super(parent2, true);

        this.parent = parent;

        //  super.setModal(true);

        thisframe = this;

        initComponents();

        achathash = new Hashtable();

        action = new TvaFrame.My_actionPerformed();

        jComboBox1.addActionListener(action);

        listemodel = new javax.swing.DefaultComboBoxModel(new String[]{java.util.ResourceBundle.getBundle("srcastra/astra/locale/tva", parent.getCurrentUser().getLangage()).getString("nat"),

                java.util.ResourceBundle.getBundle("srcastra/astra/locale/tva", parent.getCurrentUser().getLangage()).getString("intr"),

                java.util.ResourceBundle.getBundle("srcastra/astra/locale/tva", parent.getCurrentUser().getLangage()).getString("extra")});

        jComboBox1.setModel(listemodel);

        // jTextArea1.setEnabled(false);

        listener = new TvaFrame.MyMouseListener();

        achat = new ArrayList();

        System.out.println("Debut");

        tvamain = new TvaMain(this.jTree1, this, serveur, user, type, parent);

        System.out.println("fin");

        jTree1.setModel(Nachat);

        modelachat = new TvaAchatListeTableModel(serveur, user, achat);

        jTree1.addMouseListener(new MyMouseListener());

        System.out.println("fin");

        // this.setVisible(true);

        //  Logger.getDefaultLogger().log(Logger.LOG_INFOS,"Liste des achats");

        // for(int i=0;i<achat.size();i++){

        //   Object[] obj=(Object[])achat.get(i);

        // Logger.getDefaultLogger().log(Logger.LOG_INFOS,obj[0]);

        //}           

    }

    /**
     * This method is called from within the constructor to
     * <p/>
     * initialize the form.
     * <p/>
     * WARNING: Do NOT modify this code. The content of this method is
     * <p/>
     * always regenerated by the Form Editor.
     */

    private void initComponents() {//GEN-BEGIN:initComponents

        jPanel2 = new javax.swing.JPanel();

        jScrollPane2 = new javax.swing.JScrollPane();

        jTree1 = new javax.swing.JTree();

        jPanel3 = new javax.swing.JPanel();

        jScrollPane1 = new javax.swing.JScrollPane();

        jTextArea1 = new javax.swing.JTextArea();

        jPanel1 = new javax.swing.JPanel();

        jPanel4 = new javax.swing.JPanel();

        jLabel1 = new javax.swing.JLabel();

        jComboBox1 = new javax.swing.JComboBox();


        setResizable(false);

        addWindowListener(new java.awt.event.WindowAdapter() {

            public void windowClosing(java.awt.event.WindowEvent evt) {

                closeDialog(evt);

            }

        });


        jPanel2.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));

        jPanel2.setPreferredSize(new java.awt.Dimension(404, 270));

        jScrollPane2.setPreferredSize(new java.awt.Dimension(390, 250));

        jScrollPane2.setViewportView(jTree1);


        jPanel2.add(jScrollPane2);


        getContentPane().add(jPanel2, java.awt.BorderLayout.CENTER);


        jPanel3.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));

        jPanel3.setMinimumSize(new java.awt.Dimension(10, 60));

        jPanel3.setPreferredSize(new java.awt.Dimension(10, 160));

        jScrollPane1.setHorizontalScrollBarPolicy(javax.swing.JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);

        jScrollPane1.setPreferredSize(new java.awt.Dimension(390, 150));

        jTextArea1.setEditable(false);

        jTextArea1.setLineWrap(true);

        jTextArea1.setWrapStyleWord(true);

        jScrollPane1.setViewportView(jTextArea1);


        jPanel3.add(jScrollPane1);


        getContentPane().add(jPanel3, java.awt.BorderLayout.SOUTH);


        jPanel1.setLayout(new java.awt.BorderLayout());


        jPanel1.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.RAISED));

        jPanel1.setPreferredSize(new java.awt.Dimension(10, 60));

        jPanel4.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT));


        jPanel4.setBorder(new javax.swing.border.TitledBorder(null, java.util.ResourceBundle.getBundle("srcastra/astra/locale/tva", parent.getCurrentUser().getLangage()).getString("ach"), javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Tahoma", 1, 10)));

        jLabel1.setFont(new java.awt.Font("Tahoma", 0, 10));

        jLabel1.setText(java.util.ResourceBundle.getBundle("srcastra/astra/locale/tva", parent.getCurrentUser().getLangage()).getString("type"));

        jPanel4.add(jLabel1);


        jComboBox1.setModel(new javax.swing.DefaultComboBoxModel(new String[]{"National", "Intra-communautaire", "Extra-communautaire"}));

        jComboBox1.setPreferredSize(new java.awt.Dimension(150, 25));

        jPanel4.add(jComboBox1);


        jPanel1.add(jPanel4, java.awt.BorderLayout.CENTER);


        getContentPane().add(jPanel1, java.awt.BorderLayout.NORTH);


        pack();

        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();

        setSize(new java.awt.Dimension(398, 500));

        setLocation((screenSize.width - 398) / 2, (screenSize.height - 500) / 2);

    }//GEN-END:initComponents

    public class My_actionPerformed implements java.io.Serializable, java.awt.event.ActionListener {

        public void actionPerformed(java.awt.event.ActionEvent actionEvent) {

            if (jComboBox1.getSelectedIndex() == 0)

                jTree1.setModel(Nachat);

            else if (jComboBox1.getSelectedIndex() == 1)

                jTree1.setModel(Iachat);

            else if (jComboBox1.getSelectedIndex() == 2)

                jTree1.setModel(Eachat);

            ((DefaultTreeModel) jTree1.getModel()).reload();

            jTree1.repaint();

        }


    }

    /**
     * Closes the dialog
     */

    private void closeDialog(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_closeDialog

        setVisible(false);

        dispose();

    }//GEN-LAST:event_closeDialog


    /**
     * @param args the command line arguments
     */

    public static void main(String args[]) {

        //  new TvaFrame(new javax.swing.JFrame(), true).show();

    }


    public void valueChanged(javax.swing.event.TreeSelectionEvent treeSelectionEvent) {

        path = treeSelectionEvent.getPath();

        Logger.getDefaultLogger().log(Logger.LOG_INFOS, "path " + path);

        if (path.getLastPathComponent() instanceof My_node) {

            My_node selectedTerm = (My_node) path.getLastPathComponent();

            if (selectedTerm.isLeaf())

                setExplication(selectedTerm.getComponent().getLibelle3());

            Logger.getDefaultLogger().log(Logger.LOG_INFOS, "valeur lib3" + selectedTerm.getComponent().getLibelle3());

            jTextArea1.setCaretPosition(0);

        }

        System.out.println("");

    }

    private void setExplication(String text) {

        int end = 60;

        int begin = 0;

        String tmp = "";

        String tmp2 = "";

        if (text != null) {

            while (text.length() > end) {

                tmp2 = text.substring(begin, end) + "\n";

                tmp = tmp + tmp2;

                end = end + 60;

                begin = begin + 60;

            }

            jTextArea1.setText(text);

        }

    }

    /**
     * Getter for property jScrollPane2.
     *
     * @return Value of property jScrollPane2.
     */

    public javax.swing.JScrollPane getJScrollPane2() {

        return jScrollPane2;

    }


    /**
     * Setter for property jScrollPane2.
     *
     * @param jScrollPane2 New value of property jScrollPane2.
     */

    public void setJScrollPane2(javax.swing.JScrollPane jScrollPane2) {

        this.jScrollPane2 = jScrollPane2;

    }


    /**
     * Getter for property tvamediator.
     *
     * @return Value of property tvamediator.
     */

    public srcastra.astra.gui.components.tva.TvaMediator getTvamediator() {

        return tvamediator;

    }


    /**
     * Setter for property tvamediator.
     *
     * @param tvamediator New value of property tvamediator.
     */

    public void setTvamediator(srcastra.astra.gui.components.tva.TvaMediator tvamediator) {

        this.tvamediator = tvamediator;

        this.tvamediator.registeFrame(this);

    }


    /**
     * Getter for property listener.
     *
     * @return Value of property listener.
     */

    public srcastra.astra.gui.components.tva.TvaFrame.MyMouseListener getListener() {

        return listener;

    }


    /**
     * Setter for property listener.
     *
     * @param listener New value of property listener.
     */

    public void setListener(srcastra.astra.gui.components.tva.TvaFrame.MyMouseListener listener) {

        this.listener = listener;

    }


    public class MyMouseListener extends MouseAdapter implements java.io.Serializable {

        public void mouseClicked(MouseEvent evt) {

            Logger.getDefaultLogger().log(Logger.LOG_INFOS, "mouse clicked");

            if (evt.getClickCount() == 2) {

                if (path.getLastPathComponent() instanceof My_node) {

                    My_node selectedTerm = (My_node) path.getLastPathComponent();

                    if (selectedTerm.getChildCount() == 0) {

                        thisframe.dispose();

                        System.out.println("Ok je renvoi l'id " + selectedTerm.getComponent().getIdtva() + " " + selectedTerm.getComponent().getLibelle1());

                        tvamediator.setTvaCleunik(selectedTerm.getComponent().getIdtva());

                    }


                }


            }

        }

    }

    public void setTreeCleunik(int cleunik) {


    }


    /**
     * Getter for property achat.
     *
     * @return Value of property achat.
     */

    public java.util.ArrayList getAchat() {

        return achat;

    }


    /**
     * Setter for property achat.
     *
     * @param achat New value of property achat.
     */

    public void setAchat(java.util.ArrayList achat) {

        this.achat = achat;

    }


    /**
     * Getter for property modelachat.
     *
     * @return Value of property modelachat.
     */

    public srcastra.astra.gui.components.tva.TvaAchatListeTableModel getModelachat() {

        if (achat != null)

            return new TvaAchatListeTableModel(null, null, achat);

        return modelachat;

    }


    /**
     * Setter for property modelachat.
     *
     * @param modelachat New value of property modelachat.
     */

    public void setModelachat(srcastra.astra.gui.components.tva.TvaAchatListeTableModel modelachat) {

        this.modelachat = modelachat;

    }

    public void show(int cleunik, int keycode) {

        Object[] tmp = (Object[]) getAchathash().get(new Integer(cleunik));


        String s = "";

        jTree1.setSelectionRow(0);

        TreePath path;

        TreeNode[] treen2 = null;

        if (tmp != null) {

            int typemodel = ((Integer) tmp[4]).intValue();

            if (typemodel == 0)

                jTree1.setModel(Nachat);

            else if (typemodel == 1)

                jTree1.setModel(Iachat);

            else if (typemodel == 2)

                jTree1.setModel(Eachat);

            jComboBox1.setSelectedIndex(typemodel);

            TreeNode[] treen = (TreeNode[]) tmp[3];

            treen2 = new TreeNode[treen.length - 1];

            for (int i = 0; i < (treen.length - 1); i++) {

                treen2[i] = treen[i];

            }


            path = new TreePath(treen2);


            System.out.println("path to expand" + path + " cle" + cleunik);

            System.out.println("first row selection");

            jTree1.requestFocus();

            jTree1.setSelectionRow(0);

            DefaultMutableTreeNode node = (DefaultMutableTreeNode) path.getLastPathComponent();

            ((DefaultTreeModel) jTree1.getModel()).reload(node);

            //((DefaultTreeModel)jTree1.getModel()).reload((DefaultMutableTreeNode)path.getLastPathComponent());

            jTree1.expandPath(path);

            jTree1.setSelectionPath(new TreePath(treen));

            jTree1.repaint();


        }

        this.show();


    }


    /**
     * Getter for property Nachat.
     *
     * @return Value of property Nachat.
     */

    public javax.swing.tree.DefaultTreeModel getNachat() {

        return Nachat;

    }


    /**
     * Setter for property Nachat.
     *
     * @param Nachat New value of property Nachat.
     */

    public void setNachat(javax.swing.tree.DefaultTreeModel Nachat) {

        this.Nachat = Nachat;

    }


    /**
     * Getter for property Iachat.
     *
     * @return Value of property Iachat.
     */

    public javax.swing.tree.DefaultTreeModel getIachat() {

        return Iachat;

    }


    /**
     * Setter for property Iachat.
     *
     * @param Iachat New value of property Iachat.
     */

    public void setIachat(javax.swing.tree.DefaultTreeModel Iachat) {

        this.Iachat = Iachat;

    }


    /**
     * Getter for property Eachat.
     *
     * @return Value of property Eachat.
     */

    public javax.swing.tree.DefaultTreeModel getEachat() {

        return Eachat;

    }


    /**
     * Setter for property Eachat.
     *
     * @param Eachat New value of property Eachat.
     */

    public void setEachat(javax.swing.tree.DefaultTreeModel Eachat) {

        this.Eachat = Eachat;

    }


    /**
     * Getter for property achathash.
     *
     * @return Value of property achathash.
     */

    public java.util.Hashtable getAchathash() {

        return achathash;

    }


    /**
     * Setter for property achathash.
     *
     * @param achathash New value of property achathash.
     */

    public void setAchathash(java.util.Hashtable achathash) {

        this.achathash = achathash;

    }

    public void setLangue(int lmcleunik) {

        /*  if(lmcleunik==1){

            jComboBox1.setModel(listeFr);

            ((javax.swing.border.TitledBorder)jPanel4.getBorder()).setTitle("Achat");

            jLabel1.setText("Type de Tva");

        }

        else if(lmcleunik==2){

            jComboBox1.setModel(listeNl);

            jLabel1.setText("BTW type");

              ((javax.swing.border.TitledBorder)jPanel4.getBorder()).setTitle("Aankoop");

        }*/

    }


    /**
     * Getter for property jScrollPane1.
     *
     * @return Value of property jScrollPane1.
     */

    ArrayList vente;

    ArrayList achat;

    Hashtable achathash;

    TvaAchatListeTableModel modelachat;

    DefaultTreeModel Nachat;

    DefaultTreeModel Iachat;

    DefaultTreeModel Eachat;

    javax.swing.DefaultComboBoxModel listemodel;

    // Variables declaration - do not modify//GEN-BEGIN:variables

    private javax.swing.JPanel jPanel4;

    private javax.swing.JPanel jPanel3;

    private javax.swing.JPanel jPanel2;

    private javax.swing.JPanel jPanel1;

    private javax.swing.JScrollPane jScrollPane2;

    private javax.swing.JScrollPane jScrollPane1;

    private javax.swing.JComboBox jComboBox1;

    private javax.swing.JTextArea jTextArea1;

    private javax.swing.JTree jTree1;

    private javax.swing.JLabel jLabel1;

    // End of variables declaration//GEN-END:variables


}

