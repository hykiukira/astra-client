/*
 * AgendaFrame.java
 *
 * Created on 11 mars 2004, 14:51
 */

package srcastra.astra.gui.modules.agenda;

import javax.swing.*;
import java.awt.*;

import srcastra.astra.sys.rmi.*;
import srcastra.astra.sys.classetransfert.*;
import srcastra.astra.gui.modules.dossier.productSpecification.gestionnairepaneaux.*;
import srcastra.astra.gui.components.actions.actionToolBar.*;
import srcastra.*;


/**
 * @author Administrateur
 */
public class AgendaFrame extends javax.swing.JDialog implements ToolBarComposer, srcastra.astra.gui.modules.dossier.productSpecification.gestionnairepaneaux.InterfaceMainPanel {

    /**
     * Creates new form AgendaFrame
     */
    JLayeredPane layerpane;
    AgendaTa task;
    AgendaList list;
    Component selected;
    KeyStrokeManager keystroke;
    srcastra.astra.sys.classetransfert.utils.Date m_date;
    Agenda m_agenda;
    java.awt.Frame m_parent;
    astrainterface m_serveur;
    Loginusers_T m_user;
    public boolean show;

    public AgendaFrame(java.awt.Frame parent, boolean modal, astrainterface serveur, Loginusers_T user, srcastra.astra.sys.classetransfert.utils.Date date, Agenda agenda) {
        super(parent, modal);
        m_date = date;
        m_agenda = agenda;
        m_parent = parent;
        m_serveur = serveur;
        m_user = user;
        initComponents();
        task = new AgendaTa(serveur, user, date);
        list = new AgendaList(serveur, user, date);
        layerpane = new JLayeredPane();

        layerpane.add(task, 1);
        layerpane.add(list, 2);
        selected = list;
        // task.setVisible(false);
        task.setVisible(false);
        layerpane.moveToBack(task);
        layerpane.moveToFront(list);
        jPanel2.add(layerpane);
        keystroke = new KeyStrokeManager(true);
        keystroke.registerComponent(this);
        keystroke.setAction(getDefaultActionToolBarMask());
        showButton(true);
        if (list.getModel().getM_vector() != null && list.getModel().getM_vector().size() > 0) show = true;
    }

    /**
     * This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        jPanel1 = new javax.swing.JPanel();
        grp_bu_add = new javax.swing.JButton();
        grp_bu_mod = new javax.swing.JButton();
        grp_bu_val = new javax.swing.JButton();
        grp_bu_ann = new javax.swing.JButton();
        jButton1 = new javax.swing.JButton();
        jPanel2 = new javax.swing.JPanel();

        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                closeDialog(evt);
            }
        });

        grp_bu_add.setFont(new java.awt.Font("Tahoma", 0, 10));
        grp_bu_add.setText(java.util.ResourceBundle.getBundle("srcastra/astra/locale/agenda").getString("add"));
        grp_bu_add.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                grp_bu_addActionPerformed(evt);
            }
        });

        jPanel1.add(grp_bu_add);

        grp_bu_mod.setFont(new java.awt.Font("Tahoma", 0, 10));
        grp_bu_mod.setText(java.util.ResourceBundle.getBundle("srcastra/astra/locale/agenda").getString("mod"));
        grp_bu_mod.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                grp_bu_modActionPerformed(evt);
            }
        });

        jPanel1.add(grp_bu_mod);

        grp_bu_val.setFont(new java.awt.Font("Tahoma", 0, 10));
        grp_bu_val.setText(java.util.ResourceBundle.getBundle("srcastra/astra/locale/agenda").getString("valid"));
        grp_bu_val.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                grp_bu_valActionPerformed(evt);
            }
        });

        jPanel1.add(grp_bu_val);

        grp_bu_ann.setFont(new java.awt.Font("Tahoma", 0, 10));
        grp_bu_ann.setText(java.util.ResourceBundle.getBundle("srcastra/astra/locale/agenda").getString("annul"));
        grp_bu_ann.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                grp_bu_annActionPerformed(evt);
            }
        });

        jPanel1.add(grp_bu_ann);

        jButton1.setFont(new java.awt.Font("Tahoma", 0, 10));
        jButton1.setText("Print (f10)");
        jButton1.setPreferredSize(new java.awt.Dimension(92, 23));
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        jPanel1.add(jButton1);

        getContentPane().add(jPanel1, java.awt.BorderLayout.CENTER);

        jPanel2.setLayout(new java.awt.BorderLayout());

        jPanel2.setBorder(new javax.swing.border.BevelBorder(javax.swing.border.BevelBorder.LOWERED));
        jPanel2.setPreferredSize(new java.awt.Dimension(10, 450));
        getContentPane().add(jPanel2, java.awt.BorderLayout.NORTH);

        java.awt.Dimension screenSize = java.awt.Toolkit.getDefaultToolkit().getScreenSize();
        setBounds((screenSize.width - 500) / 2, (screenSize.height - 510) / 2, 500, 510);
    }//GEN-END:initComponents

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        doF10();
    }//GEN-LAST:event_jButton1ActionPerformed

    private void grp_bu_modActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_grp_bu_modActionPerformed
        doModify();
    }//GEN-LAST:event_grp_bu_modActionPerformed

    private void grp_bu_valActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_grp_bu_valActionPerformed
        doPrevious();
    }//GEN-LAST:event_grp_bu_valActionPerformed

    private void grp_bu_annActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_grp_bu_annActionPerformed
        doCancel();
    }//GEN-LAST:event_grp_bu_annActionPerformed

    private void grp_bu_addActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_grp_bu_addActionPerformed
        doCreate();
    }//GEN-LAST:event_grp_bu_addActionPerformed

    /**
     * Closes the dialog
     */
    public void close() {
        setVisible(false);
        dispose();
    }

    private void closeDialog(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_closeDialog
        setVisible(false);
        dispose();
    }//GEN-LAST:event_closeDialog

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        // new AgendaFrame(new javax.swing.JFrame(), true,null,null).show();
    }

    public void doAccept() {
    }

    public void doCancel() {
        if (selected instanceof AgendaList) {
            if (m_agenda != null)
                m_agenda.refresh();
            setVisible(false);
            dispose();

        } else {
            layerpane.moveToBack(selected);
            selected = list;
            layerpane.moveToFront(selected);
            list.requestFocus();
            showButton(true);
        }
    }

    public void doClose() {
    }

    public void doCreate() {
        if (selected instanceof AgendaList) {
            layerpane.moveToBack(list);
            task.setVisible(true);
            selected = task;
            layerpane.moveToFront(selected);
            task.setMode(1);
            task.reset();
            showButton(false);
        }
    }

    public void doDelete() {
    }

    public void doDown() {
        if (selected instanceof AgendaList)
            list.changetSelectionRow(true);
    }

    public void doF10() {
        AgendaTaskPrint taskprint = new AgendaTaskPrint(m_parent, m_user, list.getModel().getM_vector(), m_date);
        new JCFactureTest(taskprint, null, m_serveur, m_user, m_parent, 0).show();
    }

    public void doF7() {
    }

    public void doHelp() {
    }

    public void doModify() {
        if (selected instanceof AgendaList) {
            Task_T tmp = list.getSelecteTask();
            if (tmp != null) {
                layerpane.moveToBack(list);
                task.setVisible(true);
                selected = task;
                layerpane.moveToFront(selected);
                task.setMode(2);
                task.charge(tmp);
                showButton(false);
            }
        }
    }

    public void doNext() {
    }

    public void doPrevious() {
        if (selected instanceof AgendaTa) {
            task.action();
            task.setVisible(true);
            layerpane.moveToBack(selected);
            selected = list;
            layerpane.moveToFront(selected);
            list.refresh(m_date);
            list.requestFocus();
            list.refreshMemo();
            showButton(true);
        }
    }

    public void doPrint() {
    }

    public void doSwitch() {
    }

    public void doUp() {
        if (selected instanceof AgendaList)
            list.changetSelectionRow(false);

    }

    public int[] getDefaultActionToolBarMask() {
        return new int[]{ActionToolBar.DO_CREATE, ActionToolBar.DO_MODIFY, ActionToolBar.DO_CANCEL, ActionToolBar.DO_UP, ActionToolBar.DO_DOWN, ActionToolBar.DO_PREVIOUS, ActionToolBar.DO_F10};
    }

    public java.awt.Component m_getGeneriqueTable() {
        return null;
    }

    public void registerKeyboardAction(java.awt.event.ActionListener action, KeyStroke keystroke, int focusType) {
        this.jPanel1.registerKeyboardAction(action, keystroke, focusType);
    }

    public void resetKeyboardActions() {
    }

    public void setThisAsToolBarComponent() {
    }

    private void showButton(boolean list) {
        if (list) {
            grp_bu_val.setVisible(false);
            grp_bu_add.setVisible(true);

        } else {
            grp_bu_val.setVisible(true);
            grp_bu_add.setVisible(false);
        }
        if (m_agenda == null) {
            grp_bu_add.setEnabled(false);
            grp_bu_mod.setEnabled(false);
        }
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton grp_bu_add;
    private javax.swing.JButton grp_bu_ann;
    private javax.swing.JButton grp_bu_mod;
    private javax.swing.JButton grp_bu_val;
    private javax.swing.JButton jButton1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    // End of variables declaration//GEN-END:variables

}
