/*
 * EmptyAstra.java
 *
 * Created on 2 novembre 2004, 17:00
 */

package srcastra.test;
import javax.swing.*;
import java.io.*;
import java.sql.*;
import srcastra.astra.gui.sys.*;
/**
 *
 * @author  Administrateur
 */
public class EmptyAstra extends javax.swing.JFrame {
    
    /** Creates new form EmptyAstra */
    Connection astracentrum;
    Connection astra;
    public EmptyAstra() {
        initComponents();
        setBounds(0,0,800,600);
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    private void initComponents() {//GEN-BEGIN:initComponents
        java.awt.GridBagConstraints gridBagConstraints;

        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        g_te_host = new javax.swing.JTextField();
        g_te_database = new javax.swing.JTextField();
        g_te_user = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        g_te_passwd = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        jButton1 = new javax.swing.JButton();
        g_bu_connect = new javax.swing.JButton();
        jButton2 = new javax.swing.JButton();
        jLabel7 = new javax.swing.JLabel();
        g_te_centrum = new javax.swing.JTextField();

        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosing(java.awt.event.WindowEvent evt) {
                exitForm(evt);
            }
        });

        jPanel1.setLayout(new java.awt.GridBagLayout());

        jPanel1.setBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 0, 0)));
        jPanel1.setPreferredSize(new java.awt.Dimension(700, 400));
        jLabel1.setText("Fichier table text");
        jLabel1.setMaximumSize(new java.awt.Dimension(600, 30));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 6);
        jPanel1.add(jLabel1, gridBagConstraints);

        jLabel2.setMaximumSize(new java.awt.Dimension(600, 30));
        jLabel2.setPreferredSize(new java.awt.Dimension(400, 21));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridwidth = 4;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        jPanel1.add(jLabel2, gridBagConstraints);

        jLabel3.setText("Host");
        jLabel3.setMaximumSize(new java.awt.Dimension(600, 30));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 6);
        jPanel1.add(jLabel3, gridBagConstraints);

        jLabel4.setText("Database Astra");
        jLabel4.setMaximumSize(new java.awt.Dimension(600, 30));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 6);
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        jPanel1.add(jLabel4, gridBagConstraints);

        g_te_host.setMaximumSize(new java.awt.Dimension(600, 30));
        g_te_host.setPreferredSize(new java.awt.Dimension(150, 21));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        jPanel1.add(g_te_host, gridBagConstraints);

        g_te_database.setMaximumSize(new java.awt.Dimension(600, 30));
        g_te_database.setPreferredSize(new java.awt.Dimension(150, 21));
        g_te_database.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                g_te_databaseActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 3;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        jPanel1.add(g_te_database, gridBagConstraints);

        g_te_user.setMaximumSize(new java.awt.Dimension(600, 30));
        g_te_user.setPreferredSize(new java.awt.Dimension(150, 21));
        g_te_user.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                g_te_userActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        jPanel1.add(g_te_user, gridBagConstraints);

        jLabel5.setText("User");
        jLabel5.setMaximumSize(new java.awt.Dimension(600, 30));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 6);
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        jPanel1.add(jLabel5, gridBagConstraints);

        g_te_passwd.setMaximumSize(new java.awt.Dimension(600, 30));
        g_te_passwd.setPreferredSize(new java.awt.Dimension(150, 21));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        jPanel1.add(g_te_passwd, gridBagConstraints);

        jLabel6.setText("Password");
        jLabel6.setMaximumSize(new java.awt.Dimension(600, 30));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 5;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(1, 0, 1, 6);
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        jPanel1.add(jLabel6, gridBagConstraints);

        jButton1.setText("Chercher");
        jButton1.setMaximumSize(new java.awt.Dimension(600, 30));
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 5;
        gridBagConstraints.gridy = 0;
        jPanel1.add(jButton1, gridBagConstraints);

        g_bu_connect.setText("Connect DB");
        g_bu_connect.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                g_bu_connectActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.insets = new java.awt.Insets(7, 0, 0, 0);
        jPanel1.add(g_bu_connect, gridBagConstraints);

        jButton2.setText("Vider la db");
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 6;
        gridBagConstraints.insets = new java.awt.Insets(7, 5, 0, 0);
        jPanel1.add(jButton2, gridBagConstraints);

        jLabel7.setText("Database Centrum");
        jLabel7.setPreferredSize(new java.awt.Dimension(100, 15));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 6);
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        jPanel1.add(jLabel7, gridBagConstraints);

        g_te_centrum.setPreferredSize(new java.awt.Dimension(150, 21));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        jPanel1.add(g_te_centrum, gridBagConstraints);

        getContentPane().add(jPanel1, java.awt.BorderLayout.CENTER);

        pack();
    }//GEN-END:initComponents

    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
       try{
        String path=jLabel2.getText();
        if(jLabel2.getText().equals("")){
            JOptionPane.showMessageDialog(this,"TU DOIS CHOISIR UN FICHIER");
        }else{
            deleteCentrum();
            deleteTable2(path);
        }
       }catch(SQLException sn){
           ErreurScreenLibrary.displayErreur(this,  ErreurScreenLibrary.EXCEPTION, srcastra.astra.Astra.DEBUG, sn); 
        }
        finally{
            try{
                if(astra!=null){
                    astra.close();
                }
                if(astracentrum!=null){
                    astracentrum.close();
                }
            }catch(SQLException sn){
                ErreurScreenLibrary.displayErreur(this,  ErreurScreenLibrary.EXCEPTION, srcastra.astra.Astra.DEBUG, sn);
            }
            
        
        }
    }//GEN-LAST:event_jButton2ActionPerformed

    private void g_bu_connectActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_g_bu_connectActionPerformed
        try{
            String host=g_te_host.getText();
            String database=g_te_database.getText();
            String user=g_te_user.getText();
            String passwd=g_te_passwd.getText();
            String centrum=g_te_centrum.getText();
            astra=connectDb(user, passwd, database, host, 3306);
            astracentrum=connectDb(user, passwd, centrum, host, 3306);
            JOptionPane.showMessageDialog(this,"CONNECTER A LA DATABASE");
        }catch(SQLException sn){
            ErreurScreenLibrary.displayErreur(this,  ErreurScreenLibrary.EXCEPTION, srcastra.astra.Astra.DEBUG, sn);
        }
        
    }//GEN-LAST:event_g_bu_connectActionPerformed
private Connection connectDb(String userName, String password, String dbName, String dbHost, int dbPort) throws SQLException{
            String message;
            Connection tmpcon=null;
            try {
                String jdbcDriverClassName="org.gjt.mm.mysql.Driver";
                if (jdbcDriverClassName!=null)
                Class.forName(jdbcDriverClassName) ;
                tmpcon = DriverManager.getConnection("jdbc:mysql://"+dbHost+":"+dbPort+"/"+dbName+"?autoReconnect=true",userName,password);
                System.out.println("ok connecter");         
            }
            catch(ClassNotFoundException e0) {
                e0.printStackTrace();                         
            }                      
            return tmpcon;
        }
    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        JFileChooser chooser=new JFileChooser();
        chooser.showOpenDialog(this);
        File file=chooser.getSelectedFile();
        jLabel2.setText(file.getAbsolutePath());
        
    }//GEN-LAST:event_jButton1ActionPerformed

    private void g_te_userActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_g_te_userActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_g_te_userActionPerformed

    private void g_te_databaseActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_g_te_databaseActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_g_te_databaseActionPerformed
    
    /** Exit the Application */
    private void exitForm(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_exitForm
        System.exit(0);
    }//GEN-LAST:event_exitForm
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        new EmptyAstra().show();
    }
     public void deleteTable2(String path) throws SQLException{
      try{
        File file2=new File(path);
        BufferedReader in2 = new BufferedReader(new FileReader(file2));
        String str="";
        String central="DELETE FROM comptecentralisateur where cour_cleunik>7";
        String journaux="DELETE FROM journcompta WHERE jota_cleunik>24";
        String compte="DELETE FROM compte where ce_cleunik>721";
        PreparedStatement pstmt=null;
        while((str=in2.readLine())!=null){
            String requete="DELETE  FROM "+str+";";        
            pstmt=astra.prepareStatement(requete);
            pstmt.execute();      
        }
        pstmt=astra.prepareStatement(central);
        pstmt.execute();
        pstmt=astra.prepareStatement(journaux);
        pstmt.execute();
        pstmt=astra.prepareStatement(compte);
        pstmt.execute();
        in2.close();
      }catch(FileNotFoundException fn){
          ErreurScreenLibrary.displayErreur(this,  ErreurScreenLibrary.EXCEPTION, srcastra.astra.Astra.DEBUG, fn);
      }
      catch(IOException in){
          ErreurScreenLibrary.displayErreur(this,  ErreurScreenLibrary.EXCEPTION, srcastra.astra.Astra.DEBUG, in);
      }
        }
  private void deleteCentrum()throws SQLException{

    
    String requete="DELETE FROM societe";
    PreparedStatement pstmt=astracentrum.prepareStatement(requete);
    pstmt.execute();
    String requeteUser="DELETE FROM user";
    pstmt=astracentrum.prepareStatement(requeteUser);
    pstmt.execute();
    
}
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton g_bu_connect;
    private javax.swing.JTextField g_te_centrum;
    private javax.swing.JTextField g_te_database;
    private javax.swing.JTextField g_te_host;
    private javax.swing.JTextField g_te_passwd;
    private javax.swing.JTextField g_te_user;
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JPanel jPanel1;
    // End of variables declaration//GEN-END:variables
    
}
